(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70065,e=>{"use strict";var a=e.i(43476),r=e.i(47163);function s({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function t({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function n({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",e),...s})}function i({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",e),...s})}function d({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...s})}function o({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>d,"CardDescription",()=>i,"CardFooter",()=>o,"CardHeader",()=>t,"CardTitle",()=>n])},31278,e=>{"use strict";let a=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>a],31278)},23867,e=>{"use strict";var a=e.i(62265);let r="https://tjutjvm10b.execute-api.us-east-1.amazonaws.com";async function s(){try{let e=await (0,a.fetchAuthSession)(),r=e.tokens?.idToken?.toString();if(!r)throw Error("No se encontró el token de autenticación.");return r}catch(e){throw console.error("Error al obtener la sesión de autenticación:",e),Error("Usuario no autenticado.")}}async function t(e){let a=await s(),t=await fetch(`${r}/profile?userId=${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!t.ok)throw Error((await t.json()).message||"Error al obtener el perfil.");return t.json()}async function n(e,a,t){let n=await s(),i=await fetch(`${r}/profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({userId:e,address:a,name:t})});if(!i.ok)throw Error((await i.json()).message||"Error al guardar la dirección.");return i.json()}async function i(e){let a=await s(),t=await fetch(`${r}/order`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).message||"Error al crear el pedido.");return t.json()}async function d(e){let a=await s(),t=await fetch(`${r}/orders?userId=${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!t.ok)throw Error((await t.json()).message||"Error al obtener los pedidos.");return t.json()}e.s(["createOrder",()=>i,"getMyOrders",()=>d,"getProfile",()=>t,"saveAddress",()=>n])},37142,e=>{"use strict";var a=e.i(43476),r=e.i(71645),s=e.i(16934),t=e.i(23867);let n=async()=>{try{let e=await fetch("https://tjutjvm10b.execute-api.us-east-1.amazonaws.com/orders",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){let a=await e.json();throw Error(a.message||"Error al obtener los pedidos.")}return await e.json()}catch(e){throw console.error("Error en getOrders:",e),e}};var i=e.i(67881),d=e.i(70065),o=e.i(46897),l=e.i(84614),c=e.i(31278),u=e.i(75254);let m=(0,u.default)("PackageCheck",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);var h=e.i(1928);let p=(0,u.default)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),x=(0,u.default)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var f=e.i(22016),j=e.i(34286),g=e.i(55468);function y(){let{user:e,signOut:u}=(0,g.useAuthenticator)(e=>[e.user]),{items:j,total:y,clearCart:w}=(0,s.useCart)(),[N,C]=(0,r.useState)({profile:!0,order:!1,address:!1}),[b,v]=(0,r.useState)(null),[E,k]=(0,r.useState)([]),[T,A]=(0,r.useState)(""),[S,O]=(0,r.useState)(!1),[I,B]=(0,r.useState)({name:"",address:""}),[$,z]=(0,r.useState)(null),[D,P]=(0,r.useState)(null);(0,r.useEffect)(()=>{e?.username&&L()},[e]),(0,r.useEffect)(()=>{if(!$)return;let e=setInterval(async()=>{try{let a=(await n()).find(e=>e.orderId===$);a&&(P(a.status),["ENTREGADO","CANCELADO"].includes(a.status)&&clearInterval(e))}catch(e){console.error("Error durante el polling:",e)}},5e3);return()=>clearInterval(e)},[$]);let L=async()=>{if(e?.username){C(e=>({...e,profile:!0}));try{let a=(await t.getProfile(e.username)).addresses||[],r=Array.isArray(a)?a.map(e=>({name:e,address:e})):[];k(r),r.length>0&&A(r[0].address)}catch(e){console.warn("No se pudo obtener el perfil, puede que sea un usuario nuevo.",e),k([])}finally{C(e=>({...e,profile:!1}))}}},H=async a=>{if(a.preventDefault(),!e?.username||!I.name||!I.address)return void v("El nombre y la dirección son requeridos.");C(e=>({...e,address:!0})),v(null);try{await t.saveAddress(e.username,I.address,I.name),B({name:"",address:""}),O(!1),await L()}catch(e){v(e instanceof Error?e.message:"Error al guardar la dirección.")}finally{C(e=>({...e,address:!1}))}},G=async()=>{if(!e?.username||!T)return void v("Debes seleccionar una dirección de envío.");C(e=>({...e,order:!0})),v(null);let a={tenantId:"chinawok-surco",items:j.map(e=>({productId:e.id,quantity:e.quantity,price:e.price})),total:y,customer:{userId:e.username,name:e.attributes?.name||e.username,address:T}};try{let e=await t.createOrder(a);e&&e.orderId?(w(),z(e.orderId),P("EN_COCINA")):v("Hubo un problema al crear tu pedido.")}catch(e){v(e instanceof Error?e.message:"Error al procesar el pedido.")}finally{C(e=>({...e,order:!1}))}};return 0!==j.length||$?$?(0,a.jsxs)(d.Card,{className:"max-w-2xl mx-auto",children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsxs)(d.CardTitle,{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(m,{className:"h-10 w-10 text-cw-green"}),"¡Gracias por tu pedido!"]})}),(0,a.jsxs)(d.CardContent,{className:"space-y-4 text-center",children:[(0,a.jsxs)("p",{children:["ID de tu pedido: ",(0,a.jsx)("span",{className:"font-mono bg-gray-100 p-1 rounded",children:$})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-xl font-bold text-cw-green",children:[(0,a.jsx)(c.Loader2,{className:"h-5 w-5 animate-spin"}),(0,a.jsx)("span",{children:D?.replace("_"," ")||"CONSULTANDO..."})]}),"ENTREGADO"===D&&(0,a.jsx)("p",{className:"mt-4 text-green-600 font-bold",children:"¡Tu pedido ha sido entregado!"}),(0,a.jsx)(i.Button,{asChild:!0,className:"mt-6 bg-cw-green hover:bg-green-700",children:(0,a.jsx)(f.default,{href:"/",children:"Hacer otro pedido"})})]})]}):(0,a.jsxs)("div",{className:"grid gap-8 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,a.jsx)(d.Card,{children:(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsxs)(d.CardTitle,{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.User,{className:"h-5 w-5"})," Usuario"]}),(0,a.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:u,children:[(0,a.jsx)(p,{className:"h-4 w-4 mr-2"}),"Cerrar sesión"]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 pt-1",children:["Conectado como: ",e.attributes?.email||e.username]})]})}),(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.MapPin,{className:"h-5 w-5"})," Dirección de Entrega"]})}),(0,a.jsx)(d.CardContent,{children:N.profile?(0,a.jsx)(c.Loader2,{className:"h-6 w-6 animate-spin"}):(0,a.jsxs)("div",{className:"space-y-4",children:[E.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seleccionar dirección"}),(0,a.jsx)("select",{value:T,onChange:e=>A(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:E.filter(e=>e&&e.name&&e.address).map(e=>(0,a.jsxs)("option",{value:e.address,children:[e.name," - ",e.address]},`${e.name}-${e.address}`))})]}),(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>O(!S),children:[(0,a.jsx)(x,{className:"h-4 w-4 mr-2"}),S?"Cancelar":"Añadir nueva dirección"]}),S&&(0,a.jsxs)("form",{onSubmit:H,className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)("input",{type:"text",placeholder:"Nombre (ej. Casa)",value:I.name,onChange:e=>B(a=>({...a,name:e.target.value})),className:"w-full input",required:!0}),(0,a.jsx)("input",{type:"text",placeholder:"Dirección completa",value:I.address,onChange:e=>B(a=>({...a,address:e.target.value})),className:"w-full input",required:!0}),(0,a.jsxs)(i.Button,{type:"submit",disabled:N.address,className:"w-full",children:[N.address&&(0,a.jsx)(c.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Dirección"]})]})]})})]})]}),(0,a.jsx)("div",{className:"md:col-span-1",children:(0,a.jsxs)(d.Card,{className:"sticky top-24",children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{children:"Resumen de Pedido"})}),(0,a.jsx)(d.CardContent,{className:"space-y-4",children:(0,a.jsx)("div",{className:"pt-4 border-t",children:(0,a.jsx)(i.Button,{onClick:G,disabled:N.order||!T,className:"w-full bg-cw-green hover:bg-green-700 text-white text-lg h-12",children:N.order?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),"Creando pedido..."]}):"Confirmar Pedido"})})})]})})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(h.ShoppingCart,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 mb-4",children:"Tu carrito está vacío"}),(0,a.jsx)(i.Button,{asChild:!0,className:"bg-cw-green hover:bg-green-700",children:(0,a.jsx)(f.default,{href:"/",children:"Volver al menú"})})]})}function w(){return(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Finalizar Compra"}),(0,a.jsx)(j.Authenticator,{children:(0,a.jsx)(y,{})})]})}e.s(["default",()=>w],37142)}]);